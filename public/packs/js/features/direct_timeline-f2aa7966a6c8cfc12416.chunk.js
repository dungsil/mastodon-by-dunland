(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{820:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return B}));var o=s(0),a=s(1),n=s.n(a),i=s(95),r=s(4),c=s(13),l=s(114),d=s(62),h=s(760),u=s(752),p=s(751),m=s(21),g=s(29),v=s.n(g),b=s(2),M=s.n(b),f=s(15),j=s.n(f),O=s(16),_=s(131),y=s(100),x=s(99),w=s(7),k=s(34);class C extends n.a.PureComponent{renderItem(e,t,s){const{animate:a}=this.props;let n=50,i=100,r="auto",c="auto",l="auto",d="auto";1===t&&(n=100),(4===t||3===t&&s>0)&&(i=50),2===t?0===s?d="1px":c="1px":3===t?(0===s?d="1px":s>0&&(c="1px"),1===s?l="1px":s>1&&(r="1px")):4===t&&(0!==s&&2!==s||(d="1px"),1!==s&&3!==s||(c="1px"),s<2?l="1px":r="1px");const h={left:c,top:r,right:d,bottom:l,width:n+"%",height:i+"%"};return Object(o.a)("div",{style:h},e.get("id"),Object(o.a)(k.a,{account:e,animate:a}))}render(){const{accounts:e,size:t}=this.props;return Object(o.a)("div",{className:"account__avatar-composite",style:{width:t+"px",height:t+"px"}},void 0,e.take(4).map(((t,s)=>this.renderItem(t,Math.min(e.size,4),s))),e.size>4&&Object(o.a)("span",{className:"account__avatar-composite__label"},void 0,"+",e.size-4))}}C.defaultProps={animate:w.a};var I,R,L=s(86),D=s(18),T=s(72),N=s(129),S=s(9),q=s.n(S);const H=Object(r.f)({more:{id:"status.more",defaultMessage:"More"},open:{id:"conversation.open",defaultMessage:"View conversation"},reply:{id:"status.reply",defaultMessage:"Reply"},markAsRead:{id:"conversation.mark_as_read",defaultMessage:"Mark as read"},delete:{id:"conversation.delete",defaultMessage:"Delete conversation"},muteConversation:{id:"status.mute_conversation",defaultMessage:"Mute conversation"},unmuteConversation:{id:"status.unmute_conversation",defaultMessage:"Unmute conversation"}});let U=Object(r.g)(((R=class extends O.a{constructor(){super(...arguments),this.handleMouseEnter=e=>{let{currentTarget:t}=e;if(w.a)return;const s=t.querySelectorAll(".custom-emoji");for(var o=0;o<s.length;o++){let e=s[o];e.src=e.getAttribute("data-original")}},this.handleMouseLeave=e=>{let{currentTarget:t}=e;if(w.a)return;const s=t.querySelectorAll(".custom-emoji");for(var o=0;o<s.length;o++){let e=s[o];e.src=e.getAttribute("data-static")}},this.handleClick=()=>{if(!this.context.router)return;const{lastStatus:e,unread:t,markRead:s}=this.props;t&&s(),this.context.router.history.push(`/@${e.getIn(["account","acct"])}/${e.get("id")}`)},this.handleMarkAsRead=()=>{this.props.markRead()},this.handleReply=()=>{this.props.reply(this.props.lastStatus,this.context.router.history)},this.handleDelete=()=>{this.props.delete()},this.handleHotkeyMoveUp=()=>{this.props.onMoveUp(this.props.conversationId)},this.handleHotkeyMoveDown=()=>{this.props.onMoveDown(this.props.conversationId)},this.handleConversationMute=()=>{this.props.onMute(this.props.lastStatus)},this.handleShowMore=()=>{this.props.onToggleHidden(this.props.lastStatus)}}render(){const{accounts:e,lastStatus:t,unread:s,scrollKey:a,intl:n}=this.props;if(null===t)return null;const i=[{text:n.formatMessage(H.open),action:this.handleClick},null];i.push({text:n.formatMessage(t.get("muted")?H.unmuteConversation:H.muteConversation),action:this.handleConversationMute}),s&&(i.push({text:n.formatMessage(H.markAsRead),action:this.handleMarkAsRead}),i.push(null)),i.push({text:n.formatMessage(H.delete),action:this.handleDelete});const c=e.map((e=>Object(o.a)(L.a,{to:"/@"+e.get("acct"),title:e.get("acct")},e.get("id"),Object(o.a)("bdi",{},void 0,Object(o.a)("strong",{className:"display-name__html",dangerouslySetInnerHTML:{__html:e.get("display_name_html")}}))))).reduce(((e,t)=>[e,", ",t])),l={reply:this.handleReply,open:this.handleClick,moveUp:this.handleHotkeyMoveUp,moveDown:this.handleHotkeyMoveDown,toggleHidden:this.handleShowMore};return Object(o.a)(N.HotKeys,{handlers:l},void 0,Object(o.a)("div",{className:q()("conversation focusable muted",{"conversation--unread":s}),tabIndex:"0"},void 0,Object(o.a)("div",{className:"conversation__avatar",onClick:this.handleClick,role:"presentation"},void 0,Object(o.a)(C,{accounts:e,size:48})),Object(o.a)("div",{className:"conversation__content"},void 0,Object(o.a)("div",{className:"conversation__content__info"},void 0,Object(o.a)("div",{className:"conversation__content__relative-time"},void 0,s&&Object(o.a)("span",{className:"conversation__unread"})," ",Object(o.a)(T.default,{timestamp:t.get("created_at")})),Object(o.a)("div",{className:"conversation__content__names",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},void 0,Object(o.a)(r.b,{id:"conversation.with",defaultMessage:"With {names}",values:{names:Object(o.a)("span",{},void 0,c)}}))),Object(o.a)(_.a,{status:t,onClick:this.handleClick,expanded:!t.get("hidden"),onExpandedToggle:this.handleShowMore,collapsable:!0}),t.get("media_attachments").size>0&&Object(o.a)(y.a,{compact:!0,media:t.get("media_attachments")}),Object(o.a)("div",{className:"status__action-bar"},void 0,Object(o.a)(D.a,{className:"status__action-bar-button",title:n.formatMessage(H.reply),icon:"reply",onClick:this.handleReply}),Object(o.a)("div",{className:"status__action-bar-dropdown"},void 0,Object(o.a)(x.a,{scrollKey:a,status:t,items:i,icon:"ellipsis-h",size:18,direction:"right",title:n.formatMessage(H.more)}))))))}}).contextTypes={router:M.a.object},R.propTypes={conversationId:M.a.string.isRequired,accounts:j.a.list.isRequired,lastStatus:j.a.map,unread:M.a.bool.isRequired,scrollKey:M.a.string,onMoveUp:M.a.func,onMoveDown:M.a.func,markRead:M.a.func.isRequired,delete:M.a.func.isRequired,intl:M.a.object.isRequired},I=R))||I;var A=s(35),K=s(11),z=s(17),E=s(25);const P=Object(r.f)({replyConfirm:{id:"confirmations.reply.confirm",defaultMessage:"Reply"},replyMessage:{id:"confirmations.reply.message",defaultMessage:"Replying now will overwrite the message you are currently composing. Are you sure you want to proceed?"}});var V=Object(r.g)(Object(c.connect)((()=>{const e=Object(A.h)();return(t,s)=>{let{conversationId:o}=s;const a=t.getIn(["conversations","items"]).find((e=>e.get("id")===o)),n=a.get("last_status",null);return{accounts:a.get("accounts").map((e=>t.getIn(["accounts",e],null))),unread:a.get("unread"),lastStatus:n&&e(t,{id:n})}}}),((e,t)=>{let{intl:s,conversationId:o}=t;return{markRead(){e(Object(d.k)(o))},reply(t,o){e(((a,n)=>{0!==n().getIn(["compose","text"]).trim().length?e(Object(z.d)("CONFIRM",{message:s.formatMessage(P.replyMessage),confirm:s.formatMessage(P.replyConfirm),onConfirm:()=>e(Object(K.vb)(t,o))})):e(Object(K.vb)(t,o))}))},delete(){e(Object(d.i)(o))},onMute(t){t.get("muted")?e(Object(E.u)(t.get("id"))):e(Object(E.p)(t.get("id")))},onToggleHidden(t){t.get("hidden")?e(Object(E.q)(t.get("id"))):e(Object(E.o)(t.get("id")))}}}))(U)),W=s(195);class $ extends O.a{constructor(){super(...arguments),this.getCurrentIndex=e=>this.props.conversations.findIndex((t=>t.get("id")===e)),this.handleMoveUp=e=>{const t=this.getCurrentIndex(e)-1;this._selectChild(t,!0)},this.handleMoveDown=e=>{const t=this.getCurrentIndex(e)+1;this._selectChild(t,!1)},this.setRef=e=>{this.node=e},this.handleLoadOlder=v()((()=>{const e=this.props.conversations.last();e&&e.get("last_status")&&this.props.onLoadMore(e.get("last_status"))}),300,{leading:!0})}_selectChild(e,t){const s=this.node.node,o=s.querySelector(`article:nth-of-type(${e+1}) .focusable`);o&&(t&&s.scrollTop>o.offsetTop?o.scrollIntoView(!0):!t&&s.scrollTop+s.clientHeight<o.offsetTop+o.offsetHeight&&o.scrollIntoView(!1),o.focus())}render(){const{conversations:e,onLoadMore:t,...s}=this.props;return n.a.createElement(W.a,Object(m.a)({},s,{onLoadMore:t&&this.handleLoadOlder,ref:this.setRef}),e.map((e=>Object(o.a)(V,{conversationId:e.get("id"),onMoveUp:this.handleMoveUp,onMoveDown:this.handleMoveDown,scrollKey:this.props.scrollKey},e.get("id")))))}}$.propTypes={conversations:j.a.list.isRequired,scrollKey:M.a.string.isRequired,hasMore:M.a.bool,isLoading:M.a.bool,onLoadMore:M.a.func};var J,F=Object(c.connect)((e=>({conversations:e.getIn(["conversations","items"]),isLoading:e.getIn(["conversations","isLoading"],!0),hasMore:e.getIn(["conversations","hasMore"],!1)})),(e=>({onLoadMore:t=>e(Object(d.j)({maxId:t}))})))($);const Y=Object(r.f)({title:{id:"column.direct",defaultMessage:"Direct messages"}});let B=Object(c.connect)()(J=Object(r.g)(J=class extends n.a.PureComponent{constructor(){super(...arguments),this.handlePin=()=>{const{columnId:e,dispatch:t}=this.props;t(e?Object(l.h)(e):Object(l.e)("DIRECT",{}))},this.handleMove=e=>{const{columnId:t,dispatch:s}=this.props;s(Object(l.g)(t,e))},this.handleHeaderClick=()=>{this.column.scrollTop()},this.setRef=e=>{this.column=e},this.handleLoadMore=e=>{this.props.dispatch(Object(d.j)({maxId:e}))}}componentDidMount(){const{dispatch:e}=this.props;e(Object(d.l)()),e(Object(d.j)()),this.disconnect=e(Object(h.b)())}componentWillUnmount(){this.props.dispatch(Object(d.m)()),this.disconnect&&(this.disconnect(),this.disconnect=null)}render(){const{intl:e,hasUnread:t,columnId:s,multiColumn:a}=this.props,c=!!s;return n.a.createElement(u.a,{bindToDocument:!a,ref:this.setRef,label:e.formatMessage(Y.title)},Object(o.a)(p.a,{icon:"at",active:t,title:e.formatMessage(Y.title),onPin:this.handlePin,onMove:this.handleMove,onClick:this.handleHeaderClick,pinned:c,multiColumn:a}),Object(o.a)(F,{trackScroll:!c,scrollKey:"direct_timeline-"+s,timelineId:"direct",onLoadMore:this.handleLoadMore,prepend:Object(o.a)("div",{className:"follow_requests-unlocked_explanation"},void 0,Object(o.a)("span",{},void 0,Object(o.a)(r.b,{id:"compose_form.encryption_warning",defaultMessage:"Posts on Mastodon are not end-to-end encrypted. Do not share any dangerous information over Mastodon."})," ",Object(o.a)("a",{href:"/terms",target:"_blank"},void 0,Object(o.a)(r.b,{id:"compose_form.direct_message_warning_learn_more",defaultMessage:"Learn more"})))),emptyMessage:Object(o.a)(r.b,{id:"empty_column.direct",defaultMessage:"You don't have any direct messages yet. When you send or receive one, it will show up here."})}),Object(o.a)(i.a,{},void 0,Object(o.a)("title",{},void 0,e.formatMessage(Y.title)),Object(o.a)("meta",{name:"robots",content:"noindex"})))}})||J)||J}}]);
//# sourceMappingURL=direct_timeline-f2aa7966a6c8cfc12416.chunk.js.map