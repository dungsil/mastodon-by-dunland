(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{831:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return P}));var s=a(0),i=a(1),o=a.n(i),n=a(13),c=a(15),d=a.n(c),l=a(2),r=a.n(l),h=a(10),p=a(19),u=a(96),m=a(753),b=a(198),g=a(16),O=a(35),v=a(61),y=a(9),j=a.n(y),_=a(14),I=a(7),f=a(53);class M extends g.a{constructor(){super(...arguments),this.state={visible:"hide_all"!==I.h&&!this.props.attachment.getIn(["status","sensitive"])||"show_all"===I.h,loaded:!1},this.handleImageLoad=()=>{this.setState({loaded:!0})},this.handleMouseEnter=e=>{this.hoverToPlay()&&e.target.play()},this.handleMouseLeave=e=>{this.hoverToPlay()&&(e.target.pause(),e.target.currentTime=0)},this.handleClick=e=>{0!==e.button||e.ctrlKey||e.metaKey||(e.preventDefault(),this.state.visible?this.props.onOpenMedia(this.props.attachment):this.setState({visible:!0}))}}hoverToPlay(){return!I.a&&-1!==["gifv","video"].indexOf(this.props.attachment.get("type"))}render(){const{attachment:e,displayWidth:t}=this.props,{visible:a,loaded:i}=this.state,o=Math.floor((t-4)/3)-4+"px",n=o,c=e.get("status"),d=c.get("spoiler_text")||e.get("description");let l,r,h,p;if(a){if(["audio","video"].includes(e.get("type")))p=Object(s.a)("img",{src:e.get("preview_url")||e.getIn(["account","avatar_static"]),alt:e.get("description"),onLoad:this.handleImageLoad}),r="audio"===e.get("type")?Object(s.a)(_.a,{id:"music"}):Object(s.a)(_.a,{id:"play"});else if("image"===e.get("type")){const t=100*((e.getIn(["meta","focus","x"])||0)/2+.5),a=100*((e.getIn(["meta","focus","y"])||0)/-2+.5);p=Object(s.a)("img",{src:e.get("preview_url"),alt:e.get("description"),style:{objectPosition:`${t}% ${a}%`},onLoad:this.handleImageLoad})}else"gifv"===e.get("type")&&(p=Object(s.a)("video",{className:"media-gallery__item-gifv-thumbnail","aria-label":e.get("description"),role:"application",src:e.get("url"),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,autoPlay:!Object(f.a)()&&I.a,loop:!0,muted:!0}),r="GIF");l=Object(s.a)("div",{className:"media-gallery__gifv"},void 0,p,r&&Object(s.a)("span",{className:"media-gallery__gifv__label"},void 0,r))}else h=Object(s.a)("span",{className:"account-gallery__item__icons"},void 0,Object(s.a)(_.a,{id:"eye-slash"}));return Object(s.a)("div",{className:"account-gallery__item",style:{width:o,height:n}},void 0,Object(s.a)("a",{className:"media-gallery__item-thumbnail",href:`/@${c.getIn(["account","acct"])}/${c.get("id")}`,onClick:this.handleClick,title:d,target:"_blank",rel:"noopener noreferrer"},void 0,Object(s.a)(v.a,{hash:e.get("blurhash"),className:j()("media-gallery__preview",{"media-gallery__preview--hidden":a&&i}),dummy:!I.B}),a?l:h))}}M.propTypes={attachment:d.a.map.isRequired,displayWidth:r.a.number.isRequired,onOpenMedia:r.a.func.isRequired};var L,w,x=a(767),T=a(206),k=a(201),N=a(759),q=a(17),R=a(4),S=a(199);class C extends g.a{constructor(){super(...arguments),this.handleLoadMore=()=>{this.props.onLoadMore(this.props.maxId)}}render(){return Object(s.a)(k.a,{disabled:this.props.disabled,onClick:this.handleLoadMore})}}C.propTypes={maxId:r.a.string,onLoadMore:r.a.func.isRequired};let P=Object(n.connect)(((e,t)=>{let{params:{acct:a,id:s}}=t;const i=s||e.getIn(["accounts_map",Object(S.b)(a)]);return i?{accountId:i,isAccount:!!e.getIn(["accounts",i]),attachments:Object(O.a)(e,i),isLoading:e.getIn(["timelines",`account:${i}:media`,"isLoading"]),hasMore:e.getIn(["timelines",`account:${i}:media`,"hasMore"]),suspended:e.getIn(["accounts",i,"suspended"],!1),blockedBy:e.getIn(["relationships",i,"blocked_by"],!1)}:{isLoading:!0}}))(((w=class extends g.a{constructor(){super(...arguments),this.state={width:323},this.handleScrollToBottom=()=>{this.props.hasMore&&this.handleLoadMore(this.props.attachments.size>0?this.props.attachments.last().getIn(["status","id"]):void 0)},this.handleScroll=e=>{const{scrollTop:t,scrollHeight:a,clientHeight:s}=e.target;150>a-t-s&&!this.props.isLoading&&this.handleScrollToBottom()},this.handleLoadMore=e=>{this.props.dispatch(Object(p.q)(this.props.accountId,{maxId:e}))},this.handleLoadOlder=e=>{e.preventDefault(),this.handleScrollToBottom()},this.handleOpenMedia=e=>{const{dispatch:t}=this.props,a=e.getIn(["status","id"]);if("video"===e.get("type"))t(Object(q.d)("VIDEO",{media:e,statusId:a,options:{autoPlay:!0}}));else if("audio"===e.get("type"))t(Object(q.d)("AUDIO",{media:e,statusId:a,options:{autoPlay:!0}}));else{const s=e.getIn(["status","media_attachments"]),i=s.findIndex((t=>t.get("id")===e.get("id")));t(Object(q.d)("MEDIA",{media:s,index:i,statusId:a}))}},this.handleRef=e=>{e&&this.setState({width:e.offsetWidth})}}_load(){const{accountId:e,isAccount:t,dispatch:a}=this.props;t||a(Object(h.N)(e)),a(Object(p.q)(e))}componentDidMount(){const{params:{acct:e},accountId:t,dispatch:a}=this.props;t?this._load():a(Object(h.T)(e))}componentDidUpdate(e){const{params:{acct:t},accountId:a,dispatch:s}=this.props;e.accountId!==a&&a?this._load():e.params.acct!==t&&s(Object(h.T)(t))}render(){const{attachments:e,isLoading:t,hasMore:a,isAccount:i,multiColumn:n,blockedBy:c,suspended:d}=this.props,{width:l}=this.state;if(!i)return Object(s.a)(m.a,{},void 0,Object(s.a)(N.a,{}));if(!e&&t)return Object(s.a)(m.a,{},void 0,Object(s.a)(u.b,{}));let r,h=null;return!a||t&&0===e.size||(h=Object(s.a)(k.a,{visible:!t,onClick:this.handleLoadOlder})),d?r=Object(s.a)(R.b,{id:"empty_column.account_suspended",defaultMessage:"Account suspended"}):c&&(r=Object(s.a)(R.b,{id:"empty_column.account_unavailable",defaultMessage:"Profile unavailable"})),Object(s.a)(m.a,{},void 0,Object(s.a)(b.a,{multiColumn:n}),Object(s.a)(T.a,{scrollKey:"account_gallery"},void 0,Object(s.a)("div",{className:"scrollable scrollable--flex",onScroll:this.handleScroll},void 0,Object(s.a)(x.a,{accountId:this.props.accountId}),d||c?Object(s.a)("div",{className:"empty-column-indicator"},void 0,r):o.a.createElement("div",{role:"feed",className:"account-gallery__container",ref:this.handleRef},e.map(((t,a)=>null===t?Object(s.a)(C,{maxId:a>0?e.getIn(a-1,"id"):null,onLoadMore:this.handleLoadMore},"more:"+e.getIn(a+1,"id")):Object(s.a)(M,{attachment:t,displayWidth:l,onOpenMedia:this.handleOpenMedia},t.get("id")))),h),t&&0===e.size&&Object(s.a)("div",{className:"scrollable__append"},void 0,Object(s.a)(u.b,{})))))}}).propTypes={params:r.a.shape({acct:r.a.string,id:r.a.string}).isRequired,accountId:r.a.string,dispatch:r.a.func.isRequired,attachments:d.a.list.isRequired,isLoading:r.a.bool,hasMore:r.a.bool,isAccount:r.a.bool,blockedBy:r.a.bool,suspended:r.a.bool,multiColumn:r.a.bool},L=w))||L}}]);
//# sourceMappingURL=account_gallery-3a3d944f4c7ecf89294a.chunk.js.map