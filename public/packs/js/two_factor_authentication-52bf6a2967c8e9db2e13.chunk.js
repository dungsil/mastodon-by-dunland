(window.webpackJsonp=window.webpackJsonp||[]).push([[152],{744:function(e,t,n){"use strict";n.r(t);var r=n(79);function o(e){const t="==".slice(0,(4-e.length%4)%4),n=e.replace(/-/g,"+").replace(/_/g,"/")+t,r=atob(n),o=new ArrayBuffer(r.length),c=new Uint8Array(o);for(let e=0;e<r.length;e++)c[e]=r.charCodeAt(e);return o}function c(e){const t=new Uint8Array(e);let n="";for(const e of t)n+=String.fromCharCode(e);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function s(e,t,n){if("copy"===t)return n;if("convert"===t)return e(n);if(t instanceof Array)return n.map((n=>s(e,t[0],n)));if(t instanceof Object){const r={};for(const[o,c]of Object.entries(t))if(o in n)null!=n[o]?r[o]=s(e,c.schema,n[o]):r[o]=null;else if(c.required)throw new Error("Missing key: "+o);return r}}function i(e){return{required:!0,schema:e}}function a(e){return{required:!1,schema:e}}const l={type:i("copy"),id:i("convert"),transports:a("copy")},d={appid:a("copy"),appidExclude:a("copy"),credProps:a("copy")},u={appid:a("copy"),appidExclude:a("copy"),credProps:a("copy")},p={publicKey:i({rp:i("copy"),user:i({id:i("convert"),name:i("copy"),displayName:i("copy")}),challenge:i("convert"),pubKeyCredParams:i("copy"),timeout:a("copy"),excludeCredentials:a([l]),authenticatorSelection:a("copy"),attestation:a("copy"),extensions:a(d)}),signal:a("copy")},y={type:i("copy"),id:i("copy"),rawId:i("convert"),response:i({clientDataJSON:i("convert"),attestationObject:i("convert")}),clientExtensionResults:i(u)},m={mediation:a("copy"),publicKey:i({challenge:i("convert"),timeout:a("copy"),rpId:a("copy"),allowCredentials:a([l]),userVerification:a("copy"),extensions:a(d)}),signal:a("copy")},f={type:i("copy"),id:i("copy"),rawId:i("convert"),response:i({clientDataJSON:i("convert"),authenticatorData:i("convert"),signature:i("convert"),userHandle:i("convert")}),clientExtensionResults:i(u)};var g=n(54);n(512);function h(){Array.from(document.getElementsByClassName("flash-message")).forEach((function(e){e.classList.add("hidden")}))}function v(e,t){var n;r.a.post(e,JSON.stringify(t),{headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":(n=document.querySelector('meta[name="csrf-token"]'),n?n.getAttribute("content"):null)},credentials:"same-origin"}).then((function(e){window.location.replace(e.data.redirect_path)})).catch((function(e){if(422===e.response.status){document.getElementById("security-key-error-message").classList.remove("hidden"),console.error(e.response.data.error)}else console.error(e)}))}Object(g.default)((()=>{if(!(navigator.credentials&&navigator.credentials.create&&navigator.credentials.get&&window.PublicKeyCredential)){const e=document.getElementById("unsupported-browser-message");e&&(e.classList.remove("hidden"),document.querySelector(".btn.js-webauthn").disabled=!0)}const e=document.getElementById("new_webauthn_credential");e&&e.addEventListener("submit",(e=>{e.preventDefault();var t=e.target.querySelector('input[name="new_webauthn_credential[nickname]"]');t.value?r.a.get("/settings/security_keys/options").then((e=>{(async function(e){return function(e){const t=e;return t.clientExtensionResults=e.getClientExtensionResults(),s(c,y,t)}(await navigator.credentials.create(function(e){return s(o,p,e)}(e)))})({publicKey:e.data}).then((e=>{v("/settings/security_keys",{credential:e,nickname:t.value})})).catch((e=>{document.getElementById("security-key-error-message").classList.remove("hidden"),console.error(e)}))})).catch((e=>{console.error(e.response.data.error)})):t.focus()}));const t=document.getElementById("webauthn-form");if(t){t.addEventListener("submit",(e=>{e.preventDefault(),r.a.get("sessions/security_key_options").then((e=>{(async function(e){return function(e){const t=e;return t.clientExtensionResults=e.getClientExtensionResults(),s(c,f,t)}(await navigator.credentials.get(function(e){return s(o,m,e)}(e)))})({publicKey:e.data}).then((e=>{v("sign_in",{user:{credential:e}})})).catch((e=>{document.getElementById("security-key-error-message").classList.remove("hidden"),console.error(e)}))})).catch((e=>{console.error(e.response.data.error)}))}));const e=document.getElementById("otp-authentication-form");document.getElementById("link-to-otp").addEventListener("click",(()=>{t.classList.add("hidden"),e.classList.remove("hidden"),h()}));document.getElementById("link-to-webauthn").addEventListener("click",(()=>{e.classList.add("hidden"),t.classList.remove("hidden"),h()}))}}))}},[[744,0]]]);
//# sourceMappingURL=two_factor_authentication-52bf6a2967c8e9db2e13.chunk.js.map