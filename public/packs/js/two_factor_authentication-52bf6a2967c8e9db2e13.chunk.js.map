{"version":3,"sources":["webpack:///./node_modules/@github/webauthn-json/dist/main/webauthn-json.js","webpack:///./app/javascript/packs/two_factor_authentication.js"],"names":["e","t","slice","length","n","replace","r","atob","o","ArrayBuffer","c","Uint8Array","charCodeAt","String","fromCharCode","btoa","Array","map","Object","i","entries","schema","required","Error","type","id","transports","appid","appidExclude","credProps","a","s","publicKey","rp","user","name","displayName","challenge","pubKeyCredParams","timeout","excludeCredentials","authenticatorSelection","attestation","extensions","signal","p","rawId","response","clientDataJSON","attestationObject","clientExtensionResults","l","mediation","rpId","allowCredentials","userVerification","u","authenticatorData","signature","userHandle","hideFlashMessages","from","document","getElementsByClassName","forEach","flashMessage","classList","add","callback","url","body","CSRFSelector","axios","post","JSON","stringify","headers","querySelector","getAttribute","credentials","then","window","location","data","redirect_path","catch","error","status","getElementById","remove","console","ready","navigator","create","get","PublicKeyCredential","unsupported_browser_message","disabled","webAuthnCredentialRegistrationForm","addEventListener","event","preventDefault","nickname","target","value","async","getClientExtensionResults","WebAuthnJSON","credential","focus","webAuthnCredentialAuthenticationForm","otpAuthenticationForm"],"mappings":"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","file":"js/two_factor_authentication-52bf6a2967c8e9db2e13.chunk.js","sourcesContent":["function e(e) {\n  const t = \"==\".slice(0, (4 - e.length % 4) % 4),\n    n = e.replace(/-/g, \"+\").replace(/_/g, \"/\") + t,\n    r = atob(n),\n    o = new ArrayBuffer(r.length),\n    c = new Uint8Array(o);\n  for (let e = 0; e < r.length; e++) c[e] = r.charCodeAt(e);\n  return o;\n}\nfunction t(e) {\n  const t = new Uint8Array(e);\n  let n = \"\";\n  for (const e of t) n += String.fromCharCode(e);\n  return btoa(n).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=/g, \"\");\n}\nfunction n(e, t, r) {\n  if (\"copy\" === t) return r;\n  if (\"convert\" === t) return e(r);\n  if (t instanceof Array) return r.map(r => n(e, t[0], r));\n  if (t instanceof Object) {\n    const o = {};\n    for (const [c, i] of Object.entries(t)) if (c in r) null != r[c] ? o[c] = n(e, i.schema, r[c]) : o[c] = null;else if (i.required) throw new Error(\"Missing key: \" + c);\n    return o;\n  }\n}\nfunction r(e) {\n  return {\n    required: !0,\n    schema: e\n  };\n}\nfunction o(e) {\n  return {\n    required: !1,\n    schema: e\n  };\n}\nconst c = {\n    type: r(\"copy\"),\n    id: r(\"convert\"),\n    transports: o(\"copy\")\n  },\n  i = {\n    appid: o(\"copy\"),\n    appidExclude: o(\"copy\"),\n    credProps: o(\"copy\")\n  },\n  a = {\n    appid: o(\"copy\"),\n    appidExclude: o(\"copy\"),\n    credProps: o(\"copy\")\n  },\n  s = {\n    publicKey: r({\n      rp: r(\"copy\"),\n      user: r({\n        id: r(\"convert\"),\n        name: r(\"copy\"),\n        displayName: r(\"copy\")\n      }),\n      challenge: r(\"convert\"),\n      pubKeyCredParams: r(\"copy\"),\n      timeout: o(\"copy\"),\n      excludeCredentials: o([c]),\n      authenticatorSelection: o(\"copy\"),\n      attestation: o(\"copy\"),\n      extensions: o(i)\n    }),\n    signal: o(\"copy\")\n  },\n  p = {\n    type: r(\"copy\"),\n    id: r(\"copy\"),\n    rawId: r(\"convert\"),\n    response: r({\n      clientDataJSON: r(\"convert\"),\n      attestationObject: r(\"convert\")\n    }),\n    clientExtensionResults: r(a)\n  },\n  l = {\n    mediation: o(\"copy\"),\n    publicKey: r({\n      challenge: r(\"convert\"),\n      timeout: o(\"copy\"),\n      rpId: o(\"copy\"),\n      allowCredentials: o([c]),\n      userVerification: o(\"copy\"),\n      extensions: o(i)\n    }),\n    signal: o(\"copy\")\n  },\n  u = {\n    type: r(\"copy\"),\n    id: r(\"copy\"),\n    rawId: r(\"convert\"),\n    response: r({\n      clientDataJSON: r(\"convert\"),\n      authenticatorData: r(\"convert\"),\n      signature: r(\"convert\"),\n      userHandle: r(\"convert\")\n    }),\n    clientExtensionResults: r(a)\n  };\nexport const schema = {\n  credentialCreationOptions: s,\n  publicKeyCredentialWithAttestation: p,\n  credentialRequestOptions: l,\n  publicKeyCredentialWithAssertion: u\n};\nexport async function create(r) {\n  return function (e) {\n    const r = e;\n    return r.clientExtensionResults = e.getClientExtensionResults(), n(t, p, r);\n  }(await navigator.credentials.create(function (t) {\n    return n(e, s, t);\n  }(r)));\n}\nexport async function get(r) {\n  return function (e) {\n    const r = e;\n    return r.clientExtensionResults = e.getClientExtensionResults(), n(t, u, r);\n  }(await navigator.credentials.get(function (t) {\n    return n(e, l, t);\n  }(r)));\n}\nexport function supported() {\n  return !!(navigator.credentials && navigator.credentials.create && navigator.credentials.get && window.PublicKeyCredential);\n}","import axios from 'axios';\nimport * as WebAuthnJSON from '@github/webauthn-json';\nimport ready from '../mastodon/ready';\nimport 'regenerator-runtime/runtime';\n\nfunction getCSRFToken() {\n  var CSRFSelector = document.querySelector('meta[name=\"csrf-token\"]');\n  if (CSRFSelector) {\n    return CSRFSelector.getAttribute('content');\n  } else {\n    return null;\n  }\n}\n\nfunction hideFlashMessages() {\n  Array.from(document.getElementsByClassName('flash-message')).forEach(function(flashMessage) {\n    flashMessage.classList.add('hidden');\n  });\n}\n\nfunction callback(url, body) {\n  axios.post(url, JSON.stringify(body), {\n    headers: {\n      'Content-Type': 'application/json',\n      'Accept': 'application/json',\n      'X-CSRF-Token': getCSRFToken(),\n    },\n    credentials: 'same-origin',\n  }).then(function(response) {\n    window.location.replace(response.data.redirect_path);\n  }).catch(function(error) {\n    if (error.response.status === 422) {\n      const errorMessage = document.getElementById('security-key-error-message');\n      errorMessage.classList.remove('hidden');\n      console.error(error.response.data.error);\n    } else {\n      console.error(error);\n    }\n  });\n}\n\nready(() => {\n  if (!WebAuthnJSON.supported()) {\n    const unsupported_browser_message = document.getElementById('unsupported-browser-message');\n    if (unsupported_browser_message) {\n      unsupported_browser_message.classList.remove('hidden');\n      document.querySelector('.btn.js-webauthn').disabled = true;\n    }\n  }\n\n\n  const webAuthnCredentialRegistrationForm = document.getElementById('new_webauthn_credential');\n  if (webAuthnCredentialRegistrationForm) {\n    webAuthnCredentialRegistrationForm.addEventListener('submit', (event) => {\n      event.preventDefault();\n\n      var nickname = event.target.querySelector('input[name=\"new_webauthn_credential[nickname]\"]');\n      if (nickname.value) {\n        axios.get('/settings/security_keys/options')\n          .then((response) => {\n            const credentialOptions = response.data;\n\n            WebAuthnJSON.create({ 'publicKey': credentialOptions }).then((credential) => {\n              var params = { 'credential': credential, 'nickname': nickname.value };\n              callback('/settings/security_keys', params);\n            }).catch((error) => {\n              const errorMessage = document.getElementById('security-key-error-message');\n              errorMessage.classList.remove('hidden');\n              console.error(error);\n            });\n          }).catch((error) => {\n            console.error(error.response.data.error);\n          });\n      } else {\n        nickname.focus();\n      }\n    });\n  }\n\n  const webAuthnCredentialAuthenticationForm = document.getElementById('webauthn-form');\n  if (webAuthnCredentialAuthenticationForm) {\n    webAuthnCredentialAuthenticationForm.addEventListener('submit', (event) => {\n      event.preventDefault();\n\n      axios.get('sessions/security_key_options')\n        .then((response) => {\n          const credentialOptions = response.data;\n\n          WebAuthnJSON.get({ 'publicKey': credentialOptions }).then((credential) => {\n            var params = { 'user': { 'credential': credential } };\n            callback('sign_in', params);\n          }).catch((error) => {\n            const errorMessage = document.getElementById('security-key-error-message');\n            errorMessage.classList.remove('hidden');\n            console.error(error);\n          });\n        }).catch((error) => {\n          console.error(error.response.data.error);\n        });\n    });\n\n    const otpAuthenticationForm = document.getElementById('otp-authentication-form');\n\n    const linkToOtp = document.getElementById('link-to-otp');\n    linkToOtp.addEventListener('click', () => {\n      webAuthnCredentialAuthenticationForm.classList.add('hidden');\n      otpAuthenticationForm.classList.remove('hidden');\n      hideFlashMessages();\n    });\n\n    const linkToWebAuthn = document.getElementById('link-to-webauthn');\n    linkToWebAuthn.addEventListener('click', () => {\n      otpAuthenticationForm.classList.add('hidden');\n      webAuthnCredentialAuthenticationForm.classList.remove('hidden');\n      hideFlashMessages();\n    });\n  }\n});\n"],"sourceRoot":""}